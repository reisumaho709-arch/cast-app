<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å®¶è¨ˆç°¿ | Cast App</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="app">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="header">
      <div class="header-left">
        <a href="index.html" class="logo">Cast App</a>
        <div class="weekday" id="today-label">Loading...</div>
      </div>
      <div class="header-right">
        <a href="calendar.html" class="btn alt">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</a>
        <a href="kakeibo.html" class="btn alt active">å®¶è¨ˆç°¿</a>
      </div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ -->
    <div class="grid">
      <div class="left-panel">
        <h3>æ”¯å‡ºãƒªã‚¹ãƒˆ</h3>
        <div id="expense-list"></div>
      </div>

      <div class="center-panel">
        <div class="big-card">
          <div class="title">å®¶è¨ˆç°¿</div>
          <div class="summary">
            <p><b>åˆè¨ˆæ”¯å‡ºï¼š</b><span id="total-expense">0</span> å††</p>
          </div>
          <button class="btn" id="add-expense-btn">ï¼‹ æ”¯å‡ºã‚’è¿½åŠ </button>
        </div>
      </div>

      <div class="right-panel panel">
        <h3>æœ€è¿‘ã®æ”¯å‡º</h3>
        <div id="recent-expenses"></div>
      </div>
    </div>
  </div>

  <!-- è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal" id="expense-modal">
    <div class="panel">
      <h3>æ”¯å‡ºã‚’è¿½åŠ </h3>
      <div class="form-row">
        <label>æ—¥ä»˜</label>
        <input type="date" id="expense-date" class="input" />
      </div>
      <div class="form-row">
        <label>ã‚«ãƒ†ã‚´ãƒª</label>
        <select id="expense-category" class="input">
          <option value="é£Ÿè²»">ğŸ™ é£Ÿè²»</option>
          <option value="äº¤é€š">ğŸš— äº¤é€š</option>
          <option value="æ—¥ç”¨å“">ğŸ§´ æ—¥ç”¨å“</option>
          <option value="å¨¯æ¥½">ğŸ® å¨¯æ¥½</option>
          <option value="ãã®ä»–">ğŸ’¡ ãã®ä»–</option>
        </select>
      </div>
      <div class="form-row">
        <label>å†…å®¹</label>
        <input type="text" id="expense-title" class="input" placeholder="ä¾‹ï¼šã‚³ãƒ³ãƒ“ãƒ‹" />
      </div>
      <div class="form-row">
        <label>é‡‘é¡ï¼ˆå††ï¼‰</label>
        <input type="number" id="expense-amount" class="input" />
      </div>

      <div style="display:flex; gap:10px; justify-content:flex-end;">
        <button class="btn alt" id="cancel-btn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn" id="save-expense-btn">ä¿å­˜</button>
      </div>
    </div>
  </div>

  <script>
    const expenseList = document.getElementById("expense-list");
    const totalExpense = document.getElementById("total-expense");
    const recentExpenses = document.getElementById("recent-expenses");

    const modal = document.getElementById("expense-modal");
    const addExpenseBtn = document.getElementById("add-expense-btn");
    const saveExpenseBtn = document.getElementById("save-expense-btn");
    const cancelBtn = document.getElementById("cancel-btn");

    const dateInput = document.getElementById("expense-date");
    const categoryInput = document.getElementById("expense-category");
    const titleInput = document.getElementById("expense-title");
    const amountInput = document.getElementById("expense-amount");

    let expenses = JSON.parse(localStorage.getItem("expenses") || "[]");

    function saveExpenses() {
      localStorage.setItem("expenses", JSON.stringify(expenses));
    }

    function renderExpenses() {
      expenseList.innerHTML = "";
      recentExpenses.innerHTML = "";

      let total = 0;
      const sorted = [...expenses].sort(
        (a, b) => new Date(b.date) - new Date(a.date)
      );

      sorted.forEach(e => {
        const div = document.createElement("div");
        div.className = "event-item";
        div.innerHTML = `
          <div class="event-title">${e.title} <small>(${e.category})</small></div>
          <div class="event-time">${e.date}ï¼š${e.amount}å††</div>
        `;
        expenseList.appendChild(div);
        total += parseInt(e.amount);

        const recent = document.createElement("div");
        recent.className = "small-card";
        recent.innerHTML = `<b>${e.title}</b><br>${e.amount}å††<br><small>${e.date}</small>`;
        recentExpenses.appendChild(recent);
      });

      totalExpense.textContent = total.toLocaleString();
    }

    saveExpenseBtn.addEventListener("click", () => {
      const date = dateInput.value;
      const category = categoryInput.value;
      const title = titleInput.value.trim();
      const amount = parseInt(amountInput.value.trim() || "0");

      if (!date || !title || !amount) {
        alert("å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        return;
      }

      expenses.push({ date, category, title, amount });
      saveExpenses();
      renderExpenses();
      modal.classList.remove("show");

      titleInput.value = "";
      amountInput.value = "";
    });

    cancelBtn.addEventListener("click", () => modal.classList.remove("show"));
    addExpenseBtn.addEventListener("click", () => {
      dateInput.value = new Date().toISOString().split("T")[0];
      modal.classList.add("show");
    });

    document.getElementById("today-label").textContent =
      new Date().toLocaleDateString("ja-JP", { weekday: "long" });

    renderExpenses();
  </script>
</body>
</html>
