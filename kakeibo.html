<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>家計簿 | Cast App</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="app">
    <!-- ヘッダー -->
    <div class="header">
      <div class="header-left">
        <a href="index.html" class="logo">Cast App</a>
        <div class="weekday" id="today-label">Loading...</div>
      </div>
      <div class="header-right">
        <a href="calendar.html" class="btn alt">カレンダー</a>
        <a href="kakeibo.html" class="btn alt active">家計簿</a>
      </div>
    </div>

    <!-- メイン -->
    <div class="grid">
      <div class="left-panel">
        <h3>支出リスト</h3>
        <div id="expense-list"></div>
      </div>

      <div class="center-panel">
        <div class="big-card">
          <div class="title">家計簿</div>
          <div class="summary">
            <p><b>合計支出：</b><span id="total-expense">0</span> 円</p>
          </div>
          <button class="btn" id="add-expense-btn">＋ 支出を追加</button>
        </div>
      </div>

      <div class="right-panel panel">
        <h3>最近の支出</h3>
        <div id="recent-expenses"></div>
      </div>
    </div>
  </div>

  <!-- 追加モーダル -->
  <div class="modal" id="expense-modal">
    <div class="panel">
      <h3>支出を追加</h3>
      <div class="form-row">
        <label>日付</label>
        <input type="date" id="expense-date" class="input" />
      </div>
      <div class="form-row">
        <label>カテゴリ</label>
        <select id="expense-category" class="input">
          <option value="食費">🍙 食費</option>
          <option value="交通">🚗 交通</option>
          <option value="日用品">🧴 日用品</option>
          <option value="娯楽">🎮 娯楽</option>
          <option value="その他">💡 その他</option>
        </select>
      </div>
      <div class="form-row">
        <label>内容</label>
        <input type="text" id="expense-title" class="input" placeholder="例：コンビニ" />
      </div>
      <div class="form-row">
        <label>金額（円）</label>
        <input type="number" id="expense-amount" class="input" />
      </div>

      <div style="display:flex; gap:10px; justify-content:flex-end;">
        <button class="btn alt" id="cancel-btn">キャンセル</button>
        <button class="btn" id="save-expense-btn">保存</button>
      </div>
    </div>
  </div>

  <script>
    const expenseList = document.getElementById("expense-list");
    const totalExpense = document.getElementById("total-expense");
    const recentExpenses = document.getElementById("recent-expenses");

    const modal = document.getElementById("expense-modal");
    const addExpenseBtn = document.getElementById("add-expense-btn");
    const saveExpenseBtn = document.getElementById("save-expense-btn");
    const cancelBtn = document.getElementById("cancel-btn");

    const dateInput = document.getElementById("expense-date");
    const categoryInput = document.getElementById("expense-category");
    const titleInput = document.getElementById("expense-title");
    const amountInput = document.getElementById("expense-amount");

    let expenses = JSON.parse(localStorage.getItem("expenses") || "[]");

    function saveExpenses() {
      localStorage.setItem("expenses", JSON.stringify(expenses));
    }

    function renderExpenses() {
      expenseList.innerHTML = "";
      recentExpenses.innerHTML = "";

      let total = 0;
      const sorted = [...expenses].sort(
        (a, b) => new Date(b.date) - new Date(a.date)
      );

      sorted.forEach(e => {
        const div = document.createElement("div");
        div.className = "event-item";
        div.innerHTML = `
          <div class="event-title">${e.title} <small>(${e.category})</small></div>
          <div class="event-time">${e.date}：${e.amount}円</div>
        `;
        expenseList.appendChild(div);
        total += parseInt(e.amount);

        const recent = document.createElement("div");
        recent.className = "small-card";
        recent.innerHTML = `<b>${e.title}</b><br>${e.amount}円<br><small>${e.date}</small>`;
        recentExpenses.appendChild(recent);
      });

      totalExpense.textContent = total.toLocaleString();
    }

    saveExpenseBtn.addEventListener("click", () => {
      const date = dateInput.value;
      const category = categoryInput.value;
      const title = titleInput.value.trim();
      const amount = parseInt(amountInput.value.trim() || "0");

      if (!date || !title || !amount) {
        alert("全ての項目を入力してください");
        return;
      }

      expenses.push({ date, category, title, amount });
      saveExpenses();
      renderExpenses();
      modal.classList.remove("show");

      titleInput.value = "";
      amountInput.value = "";
    });

    cancelBtn.addEventListener("click", () => modal.classList.remove("show"));
    addExpenseBtn.addEventListener("click", () => {
      dateInput.value = new Date().toISOString().split("T")[0];
      modal.classList.add("show");
    });

    document.getElementById("today-label").textContent =
      new Date().toLocaleDateString("ja-JP", { weekday: "long" });

    renderExpenses();
  </script>
</body>
</html>
